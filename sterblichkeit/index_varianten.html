<head>
<meta charset="utf-8">
<meta property="og:title" content="COVID-19 Varianten in Deutschland" />
<meta property="og:description" content="als Grafik über den zeitlichen Verlauf nach Bundesland" />
<meta property="og:image" content="index_varianten.jpg" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="de_DE" />
<title>COVID-19 Varianten in Deutschland</title>
<link rel="stylesheet" href="../css/style.css" media="screen" type="text/css">
<link rel="stylesheet" media="screen" href="Chart.min.css"> 
<link rel="stylesheet" media="screen" href="nouislider.min.css"> 
<script type="text/javascript" src="Chart.min.js"></script>
<script type="text/javascript" src="nouislider.min.js"></script>
<script type="text/javascript" src="chartjs-plugin-annotation.min.js"></script>
<script type="text/javascript" src="Data_Varianten.js"></script>
<style>
    a.button[data-state='active'],
    a.button[data-state='active']:focus {
        background-color: #A9BCF5;
    }
    
    a.button.button-outline.button-small {
        padding: 0 1rem;
    }
</style> 
</head>
<body>
<a class="button" href="../">Inhalt</a>
<a class="button button-outline" href="#Anmerkungen">Anmerkungen</a> <!-- <a class="button button-outline" id="btnzoom" data-state="notactive" href="javascript:yZoom()">Zoom</a> -->
<!-- <p><strong>Hinweis: Aufgrund von Umstellungen in der Datenquelle wird diese Grafik momentan nicht aktualisiert.</strong></p> -->
<div id="countySelect"></div> 
<canvas id="myChart" style="width:990px;height: 500px;"></canvas>
<canvas id="myChart2" style="width:990px;height: 500px;"></canvas>
<br/>
<h2 id="Anmerkungen">Anmerkungen</h2>
<ul>
<li><strong>Repräsentativ?</strong><br/>
Die Charts basieren auf sequenzierten Stichproben. An Tagen, an denen die Datenlage besonders "dünn" ist, wird dies durch "kleine" Punkte (Chart 1) bzw. transparente Balken (Chart 2) verdeutlicht. Insgesamt ist die Größe der Stichproben aktuell generell recht klein, insbesondere bei der Betrachtung je Bundesland.
</li>
<li><strong>Bundesland?</strong><br/>
Die Zuordnung auf Bundesländer erfolgt lediglich anhand der Postleitzahlen der einsendenden Labore. Eine Gewißheit, daß die Proben aus dem jeweiligen Bundesland des Labores stammen besteht nicht.
</li>
<li><strong>Quellen:</strong><br/>
<a href="https://github.com/robert-koch-institut/SARS-CoV-2-Sequenzdaten_aus_Deutschland">https://github.com/robert-koch-institut/SARS-CoV-2-Sequenzdaten_aus_Deutschland</a></br>
<a href="https://github.com/corneliusroemer/desh-data/">https://github.com/corneliusroemer/desh-data/</a></br>
<a href="https://github.com/robert-koch-institut/SARS-CoV-2_Infektionen_in_Deutschland">https://github.com/robert-koch-institut/SARS-CoV-2_Infektionen_in_Deutschland</a>
</li>
</ul>
<script>
var ctx = document.getElementById('myChart').getContext('2d');
var ctx2 = document.getElementById('myChart2').getContext('2d');
var currentCounty="SH"

var zoomed=false
/*
var opt = {
        animation: false,
        responsive: false,
        title: {
            display: true,
            text: ("COVID-19 Varianten (Quelle: RKI), Stand: "+maxdate)
        },
        legend: {
            position: 'right',         
            labels: {
                boxWidth: 15,
            },
            onClick: function (e, legendItem) {
                var index = legendItem.datasetIndex
                var ci = this.chart
                var ds = ci.data.datasets[index]
                ds.hidden=!ds.hidden
                ci.update() 
            }
        },
        tooltips: {
            callbacks: {
                label: function(t, d) {
                    var data = d.datasets[t.datasetIndex].data[t.index]
                    return [d.datasets[t.datasetIndex].label +
                        ': '+d.labels[data.x] + ', ' + data.y+'%'];
                }
            }
        },
        scales: {
            yAxes: [{
                id: 'first-y-axis',
                position: 'right',
                type: 'linear',
                ticks: {
                    maxTicksLimit: 20,
                    min:0,
                    max:100,
                    //max:100,
                    callback: function(value, index, values) {
                        return value + "%"
                    }
                },
            },
            ],
            xAxes: [{
                id: 'first-x-axis',
                type: 'linear',
                ticks: {
                    callback: function(value, index, values) {
                        return cht.data.labels[value];
                    }
                },
            },
            ]
        },
        annotation: {
            annotations: [
            ]
        }
}

var cht={
        type:'bubble',
        data: chdata[currentCounty],
        options: opt
        }
*/
var opt3 = {
        animation: false,
        responsive: false,
        title: {
            display: true,
            text: ("COVID-19 Varianten in %, Stand: "+maxdate)
        },
        legend: {
            position: 'right',         
            labels: {
                boxWidth: 15,
            },
            onClick: function (e, legendItem) {
                var index = legendItem.datasetIndex
                var ci = this.chart
                var ds = ci.data.datasets[index]
                ds.hidden=!ds.hidden
                ci.update() 
            }
        },
        tooltips: {
            callbacks: {
                label: function(t, d) {
                    var data = d.datasets[t.datasetIndex].data[t.index]
                    return [d.datasets[t.datasetIndex].label +
                        ': '+ data + ' %'];
                }
            }
        },
        scales: {
            yAxes: [{
                id: 'first-y-axis',
                position: 'right',
                stacked: true,
                ticks: {
                    maxTicksLimit: 20,
                    min:0,
                    max:100,
                    callback: function(value, index, values) {
                        return value + "%"
                    }
                },                
            },
            ],
            xAxes: [{
                id: 'first-x-axis',
                stacked: true,
            },
            ]
        },
        annotation: {
            annotations: [
            ]
        },
        tooltips: {
        }
}
var cht={
        type:'bar',
        data: chdata3[currentCounty],
        options: opt3
        }


var opt2 = {
        animation: false,
        responsive: false,
        title: {
            display: true,
            text: ("COVID-19 Varianten skaliert, Stand: "+maxdate)
        },
        legend: {
            position: 'right',         
            labels: {
                boxWidth: 15,
                /*filter: function (item,data) {
                    if (item.text.indexOf('Prognose') == -1) return item
                    else return false
                }*/
            },
            onClick: function (e, legendItem) {
                var index = legendItem.datasetIndex
                var ci = this.chart
                var ds = ci.data.datasets[index]
                ds.hidden=!ds.hidden
                ci.update() 
            }
        },
        tooltips: {
            callbacks: {
                label: function(t, d) {
                    var data = d.datasets[t.datasetIndex].data[t.index]
                    return [d.datasets[t.datasetIndex].label +
                        ': skaliert: '+ data];
                }
            }
        },
        scales: {
            yAxes: [{
                id: 'first-y-axis',
                position: 'right',
                stacked: true,
            },
            ],
            xAxes: [{
                id: 'first-x-axis',
                stacked: true,
            },
            ]
        },
/*        elements: {
            rectangle: {
                backgroundColor: cht2Background,
            }
        },*/
        annotation: {
            annotations: [
            ]
        },
        tooltips: {
        }
};
var cht2={
        type:'bar',
        data: chdata2[currentCounty],
        options: opt2
};
        
        
        
setChtTitle(currentCounty)
//opt.scales.xAxes[0].labels=cht.data.labels

function setChtTitle(ccode) {
//    cht.options.title.text="COVID-19 Varianten in "+chdata[ccode]._name+", Stand: "+maxdate
    cht.options.title.text="COVID-19 Varianten Stichprobenanteil in %"+chdata3[ccode]._name+", Stand: "+maxdate
    cht2.options.title.text="COVID-19 Varianten skaliert auf 7-Tg. Inzidenz in "+chdata2[ccode]._name+", Stand: "+maxdate
}

//only called once per dataset? (of no use here)
function cht2Background(ctx) {
    var ds = ctx.dataset; //[ctx.datasetIndex];
    var cfg = ctx.chart.config;
    var co = cfg.data._bgcolors[ds._colorix];
    var cnt = cfg.data._data_count[ds.data[ctx.dataIndex]];
    
    /*if (cnt) {
        var alpha = Math.min(cnt/200,1);
        co = co.substr(0,co.length-2)+alpha+")" //replace alpha original-value: "1)"
        console.log("bg: "+co);
    }*/
	return co;
}

//**********************************************************************************************

for (var key in chdata) {
//    addCountySelect(key,chdata[key]._name,(key==currentCounty))
    addCountySelect(key,chdata3[key]._name,(key==currentCounty))
    
    /*for (var i=0;i<chdata[key].datasets.length;i++) {
        chdata[key].datasets[i].pointHitRadius=15
    }*/
}

var myChart=new Chart(ctx,cht)
var myChart2=new Chart(ctx2,cht2)



function addCountySelect(ccode,cname,isActive) {
    var cs = document.getElementById('countySelect')
    if (cs) {
        var csBtn = document.createElement('a')
        csBtn.classList.add('button')
        csBtn.classList.add('button-outline')
        csBtn.classList.add('button-small')
        csBtn.setAttribute('data-state',isActive?'active':'')
        csBtn.setAttribute('id','cbtn'+ccode)
        csBtn.setAttribute('title',cname)
        csBtn.setAttribute('href','javascript:selectCounty("'+ccode+'")')
        csBtn.appendChild(document.createTextNode(ccode))
        cs.appendChild(csBtn)
    }

} 

function selectCounty(ccode) {
    if (ccode!=currentCounty) {
        setBtnState('cbtn'+currentCounty,'')
        currentCounty=ccode
        setBtnState('cbtn'+currentCounty,'active')

        //copy hidden state of datasets
        for (var i=0;i<cht.data.datasets.length;i++) {
//            chdata[ccode].datasets[i].hidden=cht.data.datasets[i].hidden
            chdata3[ccode].datasets[i].hidden=cht.data.datasets[i].hidden
        }
        for (var i=0;i<cht2.data.datasets.length;i++) {
            chdata2[ccode].datasets[i].hidden=cht2.data.datasets[i].hidden
        }

//        cht.data=chdata[ccode]
        cht.data=chdata3[ccode]
        cht2.data=chdata2[ccode]
        setChtTitle(ccode)
        myChart.update()
        myChart2.update()
    }
}

function getBtnState(id) {
    var elem = document.getElementById(id);
    return (elem.getAttribute('data-state')=='active')
}

function setBtnState(id,strState) {
    var elem = document.getElementById(id);
    if (elem) elem.setAttribute('data-state',strState)
}


//**********************************************************************************************
//source/credits: http://www.salesianer.de/util/kalwoch.html
function kalenderwoche(Datum) {
    //var Datum=new Date(j,m-1,t)
    var DoDat=donnerstag(Datum)
    var kwjahr=DoDat.getFullYear()
    var DoKW1=donnerstag(new Date(kwjahr,0,4))
    return Math.floor(1.5+(DoDat.getTime()-DoKW1.getTime())/86400000/7)
}

function donnerstag(datum) {
  var Do=new Date()
  Do.setTime(datum.getTime() + (3-((datum.getDay()+6) % 7)) * 86400000)
  return Do
}

function montag(datum) {
  var Mo=new Date()
  Mo.setTime(datum.getTime() + (-((datum.getDay()+6) % 7)) * 86400000)
  return Mo
}

</script>
</body>