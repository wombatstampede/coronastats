<head>
<meta charset="utf-8">
<meta property="og:title" content="COVID-19 Impfungen in Deutschland" />
<meta property="og:description" content="als Grafik über den zeitlichen Verlauf nach Bundesland" />
<meta property="og:image" content="index_sh_impf.jpg" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="de_DE" />
<title>COVID-19 Impfungen in Deutschland</title>
<link rel="stylesheet" href="../css/style.css" media="screen" type="text/css">
<link rel="stylesheet" media="screen" href="Chart.min.css"> 
<script type="text/javascript" src="Chart.min.js"></script>
<script type="text/javascript" src="chartjs-plugin-annotation.min.js"></script>
<script type="text/javascript" src="Data_SH_Impf.js"></script>
<style>
    a.button[data-state='active'],
    a.button[data-state='active']:focus {
        background-color: #A9BCF5;
    }
    
    a.button.button-outline.button-small {
        padding: 0 1rem;
    }
</style> 
</head>
<body>
<a class="button" href="../">Inhalt</a>
<a class="button button-outline" href="#Anmerkungen">Anmerkungen</a>
<div id="countySelect"></div> 
<canvas id="myChart" style="width:990px;height: 700px;"></canvas>
<br/>
<h2 id="Anmerkungen">Anmerkungen</h2>
<ul>
<li>Diese Grafik basiert auf den vom RKI veröffentlichten <a href="https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Daten/Impfquotenmonitoring.html">Impfquoten</a>. Konkret werden <a href="https://github.com/ard-data/2020-rki-impf-archive">Dateien</a> verwendet, die die <a href="https://github.com/ard-data/2020-rki-impf-archive">ARD</a> aus den RKI-Daten aufbereitet.</li>
</ul>
<script>
var ctx = document.getElementById('myChart').getContext('2d');
var opt = {
        responsive: false,
        title: {
            display: true,
            text: "COVID-19-Impfungen (Quelle: RKI/ARD)"
        },
        legend: {
            labels: {
                boxWidth: 25,
            }
        },
        scales: {
            yAxes: [{
                id: 'first-y-axis',
                position: 'right',
                type: 'linear',
                ticks: {
                    maxTicksLimit: 50,
                    min:0,
                    //min:-2
                }
                //type: 'logarithmic'
            }]
        },
        annotation: {
            annotations: [
            ]
        },
    };

//*************************  add annotations for last 10 weeks on Monday ***********************

/*
var Mo=montag(new Date())
var dayTicks=86400000
for(w = Mo.getTime() ; w >= Mo.getTime()-(10*7*dayTicks) ; w -= (7*dayTicks)) {

    var kwMo = new Date(w)
    var kwVal = kalenderwoche(kwMo)
    
    var oneAnnot = {
                type: "line",
                drawTime: "beforeDatasetsDraw",
                mode: "vertical",
                scaleID: "x-axis-0",
                value: kwMo.toISOString().slice(0, 10),
                borderColor: 'rgba(0,0,0,0.25)',
                borderWidth: 0,
                label: {
                  //backgroundColor: "red",
                  backgroundColor: 'rgba(220,220,220,1)',
                  //fontColor: window.chartColors.red,
                  xPadding: 3,
                  yPadding: 3,
                  //yAdjust: 2,
                  fontColor: "black",
                  fontSize: 8,
                  content: "KW"+kwVal+" >",
                  position: "top",
                  enabled: true
                },
            }
    chdata.options.annotation.annotations.push(oneAnnot)
}
 */   
//**********************************************************************************************

var currentCounty="SH"
var cht={
        type:'bar',
        data: chdata[currentCounty],
        options: opt
        }

for (var key in chdata) {
    addCountySelect(key,chdata[key]._name,(key==currentCounty))
    
    for (i=0;i<chdata[key].datasets.length;i++) {
        chdata[key].datasets[i].pointHitRadius=15
        //chdata.datasets[i].pointHoverRadius=5
    }
}

var myChart=new Chart(ctx,cht)

//**********************************************************************************************

function addCountySelect(ccode,cname,isActive) {
    var cs = document.getElementById('countySelect')
    if (cs) {
        var csBtn = document.createElement('a')
        csBtn.classList.add('button')
        csBtn.classList.add('button-outline')
        csBtn.classList.add('button-small')
        csBtn.setAttribute('data-state',isActive?'active':'')
        csBtn.setAttribute('id','cbtn'+ccode)
        csBtn.setAttribute('title',cname)
        csBtn.setAttribute('href','javascript:selectCounty("'+ccode+'")')
        csBtn.appendChild(document.createTextNode(ccode))
        cs.appendChild(csBtn)
    }

} 

function selectCounty(ccode) {
    if (ccode!=currentCounty) {
        setBtnState('cbtn'+currentCounty,'')
        currentCounty=ccode
        setBtnState('cbtn'+currentCounty,'active')
        
        cht.data=chdata[ccode]
        cht.options.title.text="COVID-19 Impfungen in "+chdata[ccode]._name
        myChart.update()
    }
}
 
function getBtnState(id) {
    var elem = document.getElementById(id);
    return (elem.getAttribute('data-state')=='active')
}

function setBtnState(id,strState) {
    var elem = document.getElementById(id);
    if (elem) elem.setAttribute('data-state',strState)
}

//**********************************************************************************************
//source/credits: http://www.salesianer.de/util/kalwoch.html
function kalenderwoche(Datum) {
    //var Datum=new Date(j,m-1,t)
    var DoDat=donnerstag(Datum)
    var kwjahr=DoDat.getFullYear()
    var DoKW1=donnerstag(new Date(kwjahr,0,4))
    return Math.floor(1.5+(DoDat.getTime()-DoKW1.getTime())/86400000/7)
}

function donnerstag(datum) {
  var Do=new Date()
  Do.setTime(datum.getTime() + (3-((datum.getDay()+6) % 7)) * 86400000)
  return Do
}

function montag(datum) {
  var Mo=new Date()
  Mo.setTime(datum.getTime() + (-((datum.getDay()+6) % 7)) * 86400000)
  return Mo
}

</script>
</body>
